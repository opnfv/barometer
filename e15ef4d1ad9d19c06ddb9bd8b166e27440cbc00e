{
  "comments": [
    {
      "key": {
        "uuid": "209837c9_00561740",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 7425
      },
      "writtenOn": "2021-06-23T15:45:58Z",
      "side": 1,
      "message": "If we are going this route, a reader will ask: what are the security issues...?\n\nThe real solution here would be to fix the spec file in the repo where collectd is pulled from, it is available in both epel and centos-release-opstools.",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8829abae_ef272721",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 2311
      },
      "writtenOn": "2021-06-23T16:21:38Z",
      "side": 1,
      "message": "That would be this repo, right [1], mirrored from [2]?\n\n[1] https://github.com/centos-opstools/collectd\n[2] https://review.rdoproject.org/r/q/project:centos-opstools/collectd?",
      "parentUuid": "209837c9_00561740",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7d18ad0d_3a079d2b",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 7425
      },
      "writtenOn": "2021-06-23T16:26:59Z",
      "side": 1,
      "message": "yes. that\u0027s the one.",
      "parentUuid": "8829abae_ef272721",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a46fa4e6_1f13c647",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 2311
      },
      "writtenOn": "2021-06-23T16:48:37Z",
      "side": 1,
      "message": "varnish is already disabled there, AFAICT.",
      "parentUuid": "7d18ad0d_3a079d2b",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a96efb87_acea2868",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 7425
      },
      "writtenOn": "2021-06-23T18:11:39Z",
      "side": 1,
      "message": "Yes, from looking at the spec file, varnish is disabled.",
      "parentUuid": "a46fa4e6_1f13c647",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5a3808d0_e398319f",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 6511
      },
      "writtenOn": "2021-06-25T06:55:28Z",
      "side": 1,
      "message": "OK, but what decides what is installed with \"dnf builddep -y collectd\"? The varnish and varnish -devel is installed by this command. If it is based on collectd specfile, then it probably should contain all possible dependencies for collectd plugins, but we want to disable varnish only for barometer.\nThe issue identified by snyk is https://access.redhat.com/errata/RHSA-2020:4756.",
      "parentUuid": "a96efb87_acea2868",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d63cf0c1_99f1170b",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 7425
      },
      "writtenOn": "2021-06-25T07:17:28Z",
      "side": 1,
      "message": "What is listed as build dependency.\n\nTo get a fix for the varnish issue, you\u0027d dnf update; depending on the issue, collectd would have to be rebuilt (if the varnish plugin was enabled and built).",
      "parentUuid": "5a3808d0_e398319f",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92361f22_446e6b01",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 6511
      },
      "writtenOn": "2021-06-25T07:31:45Z",
      "side": 1,
      "message": "So my understanding is that spec file is available from epel and centos-opstools. Since in opstools it is disabled, it means it has to be enabled in epel?\nDnf update does not help, because for CentOS 8 only affected version is available (6.0.6-2.module_el8.3.0+399+10bd7ebd from appstream). The update seems to be available only for subscribed RHEL users.",
      "parentUuid": "d63cf0c1_99f1170b",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7d8d51be_49a13117",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 2311
      },
      "writtenOn": "2021-06-25T12:46:58Z",
      "side": 1,
      "message": "This can be worked around in two ways (perhaps more):\n\n* don\u0027t enable epel so we get the collectd version from opstoools\n  I don\u0027t think this is the issue, as the version in epel is 5.8 vs 5.11 in opstools.\n  I need to validate that we still get all required dependencies though\n\n* Use the spec file in collectd/contrib/redhat/ (after patching) to install the deps. (According to the docs, this is possible, but I need to double check\n  This potentially requires a bit of a bigger change to move things around.\n  However, I was considering using the build_rpm.sh script in the container images for a split build already, so some refactor would be fine.",
      "parentUuid": "92361f22_446e6b01",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "854eba51_33c5f70e",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 2311
      },
      "writtenOn": "2021-06-25T12:59:18Z",
      "side": 1,
      "message": "* Removing epel-release worked for the varnish issue, and it is no longer installed.\n\nNow, when the script tries to remove varnish and varnish-devel, the are flagged as not present.\n\nI think the older version (collectd-5.8 from epel) of collectd was being used by `dnf builddep collectd`.\n\n\nIMHO, this patch should be re-spun and remove `dnf install -y epel-release` on lines 31 and 91/92.\n\nThe title can be \"Remove older packages that are causing security issues\"\n\n@Slawomir, I\u0027m happy to respin this patch to do the changes, it you\u0027re okay with that.",
      "parentUuid": "7d8d51be_49a13117",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "95d7afb2_ece5e254",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 6511
      },
      "writtenOn": "2021-06-25T14:11:14Z",
      "side": 1,
      "message": "I gave it a try, and after removing epel-release the `dnf builddep collectd` does not give results at all: \"no package matched: collectd\".\nIt seems that something is missing or something else should be done to fully enable centos-release-opstools?",
      "parentUuid": "854eba51_33c5f70e",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d093bd14_be111ad8",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 40,
      "author": {
        "id": 2311
      },
      "writtenOn": "2021-06-25T14:44:27Z",
      "side": 1,
      "message": "That is odd, and I\u0027m seeing the same thing. `dnf provides collectd` returns results.\nThis explains why we were seeing that builddep used the epel source.\n \nPerhaps I should recommend skipping directly to ``dnf builddep /path/to/collectd/contrib/redhat/collectd.spec`` after applying the patch.\n\nHowever, for now, running ci/install_dependencies.sh and ci/build_rpm.sh (which get package lists from build_base_machine.sh) does end up installing the required packages, probably because they are explicitly included below.\n\n@Matthias, you are better placed to answer the question than I am:\nWhy does ``dnf builddep collectd`` fail to get the reqs from opstools, even when ``dnf provides collectd?`` returns a result from opstools?",
      "parentUuid": "95d7afb2_ece5e254",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f66702f_2ad2e943",
        "filename": "systems/centos/8/build_base_machine.sh",
        "patchSetId": 7
      },
      "lineNbr": 92,
      "author": {
        "id": 2311
      },
      "writtenOn": "2021-06-25T12:59:18Z",
      "side": 1,
      "message": "Per discussion above, this should be removed",
      "revId": "e15ef4d1ad9d19c06ddb9bd8b166e27440cbc00e",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": true
    }
  ]
}